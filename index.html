<!doctype html>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Opening ShotSense…</title>
<style>
  body{font-family:system-ui,Arial,sans-serif;display:flex;min-height:100vh;align-items:center;justify-content:center;padding:24px}
  .card{max-width:560px;border:1px solid #eee;border-radius:12px;padding:20px;box-shadow:0 8px 24px rgba(0,0,0,.08)}
  h1{font-size:18px;margin:0 0 8px}
  .btn{margin-top:14px;display:inline-block;padding:10px 14px;border:1px solid #ddd;border-radius:8px;text-decoration:none}
  .hint{margin-top:12px;font-size:14px;color:#555}
</style>
<div class="card">
  <h1>Opening ShotSense…</h1>
  <div id="msg">Redirecting to the app.</div>
  <a id="fallback" class="btn" style="display:none" href="#">Open manually</a>
  <div class="hint">If nothing happens, open the ShotSense app and try again.</div>
</div>
<script>
  const raw = location.hash?.slice(1) || location.search?.slice(1) || "";
  const p = new URLSearchParams(raw);
  const type = p.get("type"); // 'recovery' | 'signup' | 'magiclink'...
  const route = type === "recovery" ? "reset-password" : "auth-callback";

  const deeplinks = [
    `shotsense://${route}?${p.toString()}`,       // production / custom dev client
    `exp+shotsense://${route}?${p.toString()}`,   // Expo Go during dev
  ];

  const msg = document.getElementById("msg");
  const fallback = document.getElementById("fallback");

  let i = 0;
  function tryNext() {
    if (i >= deeplinks.length) {
      msg.textContent = "Couldn’t open the app automatically.";
      fallback.href = deeplinks[0];
      fallback.style.display = "inline-block";
      return;
    }
    window.location.href = deeplinks[i++];
    setTimeout(tryNext, 900);
  }
  tryNext();
</script>
